import{j as e,L as i}from"./index-VvjsA-rq.js";import{r as s}from"./chunk.BQy9AZNB.js";import{g as n}from"./chunk.DXnYxceR.js";import"./chunk.DEQ385Nk.js";import"./chunk.BhLMWRjL.js";import"./chunk.Bzdb9GAy.js";import"./web-vitals.DbSUPk88.js";const t=()=>{const{loading:t,error:a}=n(e=>e.drive),{isAuthenticated:d,serviceAccount:l}=n(e=>e.auth),[c,o]=s.useState(null),[m,r]=s.useState([]),[h,v]=s.useState([]),[p,u]=s.useState([]),[x,j]=s.useState("grid"),[g,b]=s.useState(""),[f,N]=s.useState(!1),[w,B]=s.useState(""),[k,T]=s.useState(""),y=[{id:"1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms",name:"Báo cáo tháng 1.xlsx",type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",size:"2.5 MB",modifiedTime:"2024-01-15T10:30:00Z",owner:"admin@mia.vn",webViewLink:"https://drive.google.com/file/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/view"},{id:"1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms2",name:"Danh sách khách hàng.pdf",type:"application/pdf",size:"1.2 MB",modifiedTime:"2024-01-14T15:45:00Z",owner:"admin@mia.vn",webViewLink:"https://drive.google.com/file/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms2/view"},{id:"1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms3",name:"Hợp đồng mẫu.docx",type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",size:"850 KB",modifiedTime:"2024-01-13T09:20:00Z",owner:"admin@mia.vn",webViewLink:"https://drive.google.com/file/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms3/view"}],C=[{id:"1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms_folder1",name:"Tài liệu công ty",modifiedTime:"2024-01-15T10:30:00Z",owner:"admin@mia.vn"},{id:"1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms_folder2",name:"Báo cáo hàng tháng",modifiedTime:"2024-01-14T15:45:00Z",owner:"admin@mia.vn"},{id:"1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms_folder3",name:"Hợp đồng khách hàng",modifiedTime:"2024-01-13T09:20:00Z",owner:"admin@mia.vn"}];s.useEffect(()=>{r(y),v(C)},[]);const M=m.filter(e=>e.name.toLowerCase().includes(g.toLowerCase())),U=h.filter(e=>e.name.toLowerCase().includes(g.toLowerCase())),V=e=>{u(i=>i.includes(e)?i.filter(i=>i!==e):[...i,e])},L=e=>new Date(e).toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return t?e.jsx(i,{}):a?e.jsxs("div",{className:"error-state",children:["Lỗi: ",a]}):e.jsxs("div",{className:"drive-integration-container",children:[e.jsxs("div",{className:"drive-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:"📁 Google Drive"}),e.jsxs("div",{className:"breadcrumb",children:[e.jsx("span",{children:"Drive của tôi"}),c&&e.jsxs("span",{children:[" / ",c.name]})]})]}),e.jsxs("div",{className:"header-right",children:[e.jsxs("div",{className:"view-controls",children:[e.jsx("button",{className:"view-btn "+("grid"===x?"active":""),onClick:()=>j("grid"),children:"⊞"}),e.jsx("button",{className:"view-btn "+("list"===x?"active":""),onClick:()=>j("list"),children:"☰"})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>{B("folder"),N(!0)},children:"📁 Tạo thư mục"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{B("file"),N(!0)},children:"📄 Tạo tệp"}),e.jsx("button",{className:"btn btn-secondary",children:"⬆️ Tải lên"})]})]})]}),e.jsxs("div",{className:"drive-toolbar",children:[e.jsx("div",{className:"toolbar-left",children:e.jsx("input",{type:"text",placeholder:"Tìm kiếm tệp tin và thư mục...",value:g,onChange:e=>b(e.target.value),className:"search-input"})}),e.jsxs("div",{className:"toolbar-right",children:[p.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"selected-count",children:[p.length," mục đã chọn"]}),e.jsx("button",{className:"btn btn-danger",onClick:()=>{0!==p.length&&(r(e=>e.filter(e=>!p.includes(e.id))),v(e=>e.filter(e=>!p.includes(e.id))),u([]))},children:"🗑️ Xóa"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{0!==p.length&&p.forEach(e=>{const i=[...m,...h].find(i=>i.id===e);i&&i.webViewLink&&window.open(i.webViewLink,"_blank")})},children:"⬇️ Tải xuống"})]}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{const e=[["Tên","Loại","Kích thước","Ngày sửa","Chủ sở hữu","ID"],...m.map(e=>[e.name,e.type,e.size,new Date(e.modifiedTime).toLocaleDateString("vi-VN"),e.owner,e.id])].map(e=>e.join(",")).join("\n"),i=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(i),s.download="google_drive_files.csv",s.click()},children:"📊 Xuất CSV"})]})]}),e.jsxs("div",{className:"drive-content",children:[U.length>0&&e.jsxs("div",{className:"folders-section",children:[e.jsx("h3",{children:"📁 Thư mục"}),e.jsx("div",{className:`items-grid ${x}`,children:U.map(i=>e.jsxs("div",{className:"item-card "+(p.includes(i.id)?"selected":""),onClick:()=>V(i.id),children:[e.jsx("div",{className:"item-icon",children:"📁"}),e.jsxs("div",{className:"item-info",children:[e.jsx("div",{className:"item-name",children:i.name}),e.jsx("div",{className:"item-meta",children:L(i.modifiedTime)})]}),e.jsx("div",{className:"item-actions",children:e.jsx("button",{className:"action-btn",onClick:e=>{e.stopPropagation()},title:"Xem ID",children:"👁️"})})]},i.id))})]}),M.length>0&&e.jsxs("div",{className:"files-section",children:[e.jsx("h3",{children:"📄 Tệp tin"}),e.jsx("div",{className:`items-grid ${x}`,children:M.map(i=>{return e.jsxs("div",{className:"item-card "+(p.includes(i.id)?"selected":""),onClick:()=>V(i.id),children:[e.jsx("div",{className:"item-icon",children:(n=i.type,n.includes("spreadsheet")?"📊":n.includes("document")?"📄":n.includes("pdf")?"📕":n.includes("image")?"🖼️":n.includes("video")?"🎥":n.includes("audio")?"🎵":n.includes("folder")?"📁":"📄")}),e.jsxs("div",{className:"item-info",children:[e.jsx("div",{className:"item-name",children:i.name}),e.jsxs("div",{className:"item-meta",children:[(s=i.size,s||"0 KB")," •"," ",L(i.modifiedTime)]})]}),e.jsxs("div",{className:"item-actions",children:[e.jsx("button",{className:"action-btn",onClick:e=>{e.stopPropagation(),window.open(i.webViewLink,"_blank")},title:"Mở",children:"🔗"}),e.jsx("button",{className:"action-btn",onClick:e=>{e.stopPropagation()},title:"Xem ID",children:"👁️"})]})]},i.id);var s,n})})]}),0===M.length&&0===U.length&&e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"📁"}),e.jsx("h3",{children:"Không có tệp tin nào"}),e.jsx("p",{children:"Tạo thư mục hoặc tải lên tệp tin để bắt đầu"})]})]}),f&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"file"===w?"Tạo tệp tin mới":"Tạo thư mục mới"}),e.jsx("button",{className:"close-btn",onClick:()=>N(!1),children:"✕"})]}),e.jsx("div",{className:"modal-body",children:e.jsx("input",{type:"text",placeholder:"file"===w?"Tên tệp tin":"Tên thư mục",value:k,onChange:e=>T(e.target.value),className:"input-field",autoFocus:!0})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>N(!1),children:"Hủy"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{if(!k.trim())return;const e={id:`new_${Date.now()}`,name:k,type:"file"===w?"text/plain":"application/vnd.google-apps.folder",size:"file"===w?"0 KB":"",modifiedTime:(new Date).toISOString(),owner:"admin@mia.vn"};"file"===w?r(i=>[e,...i]):v(i=>[e,...i]),T(""),N(!1),B("")},disabled:!k.trim(),children:"Tạo"})]})]})})]})};export{t as default};
